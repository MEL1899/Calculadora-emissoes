<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Carbono - Mantram</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 900px; 
            margin: 50px auto; 
            padding: 20px; 
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        h1 { 
            color: #2c3e50; 
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
        }
        .formulario { 
            background: white;
            border: 1px solid #ddd; 
            padding: 30px; 
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 20px;
        }
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 600;
            color: #34495e;
        }
        input[type="email"],
        input[type="number"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }
        input[type="email"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        button { 
            width: 100%;
            padding: 12px; 
            cursor: pointer;
            background: #2ecc71; 
            color: white; 
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s;
        }
        button:hover {
            background: #27ae60;
        }
        .info-text {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .radio-option input[type="radio"] {
            width: auto;
            cursor: pointer;
        }
        .radio-option label {
            margin-bottom: 0;
            font-weight: 500;
            cursor: pointer;
        }
        .hidden {
            display: none !important;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        .map-container {
            margin: 20px 0;
        }
        #map {
            height: 400px;
            width: 100%;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .address-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        @media (max-width: 768px) {
            .address-group {
                grid-template-columns: 1fr;
            }
        }
        .btn-calculate-distance {
            background: #3498db;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        .btn-calculate-distance:hover {
            background: #2980b9;
        }
        .distance-result {
            margin-top: 10px;
            padding: 10px;
            background: #e8f4f8;
            border-radius: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
    </style>
    <!-- Google Maps API - Carregamento Direto -->
    {% if google_maps_api_key and google_maps_api_key != 'YOUR_API_KEY' %}
    <script>
        // Vari√°vel global para controle
        window.GOOGLE_MAPS_LOADED = false;
        window.GOOGLE_MAPS_API_KEY = '{{ google_maps_api_key }}';
        
        // Carrega o Google Maps com tratamento de erros
        function loadGoogleMapsScript() {
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${window.GOOGLE_MAPS_API_KEY}&libraries=places,geometry&callback=initMap`;
            script.async = true;
            script.defer = true;
            
            script.onerror = function() {
                showMapError('Erro ao carregar o script do Google Maps. Verifique se bloqueadores de anuncios estao desativados.');
            };
            
            script.onload = function() {
                console.log('Script do Google Maps carregado com sucesso');
            };
            
            document.head.appendChild(script);
        }
        
        // Timeout para detectar se n√£o carregou
        setTimeout(function() {
            if (!window.GOOGLE_MAPS_LOADED && typeof google === 'undefined') {
                showMapError('Google Maps nao carregou. Verifique bloqueadores de anuncios ou restricoes de referenciador.');
            }
        }, 10000);
        
        // Fun√ß√£o para mostrar erro
        function showMapError(message) {
            const mapContainer = document.getElementById('map');
            if (mapContainer) {
                mapContainer.innerHTML = '<div style="padding: 50px; text-align: center; color: #e74c3c; background: #ffe6e6; border-radius: 8px;"><h3>Erro: Google Maps nao carregou</h3><p><strong>' + message + '</strong></p><p style="margin-top: 15px; font-size: 14px;"><strong>SOLUCOES:</strong></p><ol style="text-align: left; display: inline-block; max-width: 650px; font-size: 13px; line-height: 1.8;"><li><strong>Desative bloqueadores de anuncios</strong> (AdBlock, uBlock, etc.)</li><li>Acesse: <a href="https://console.cloud.google.com/apis/credentials" target="_blank" style="color: #3498db;">Google Cloud Console</a></li><li>Em "Restricoes de aplicativo", escolha "Nenhuma"</li><li>Salve e aguarde 30 segundos</li><li>Recarregue: <strong>Ctrl+F5</strong></li></ol><p style="margin-top: 20px; font-size: 12px; color: #7f8c8d;">Subir o site para a internet (com dominio proprio) pode resolver problemas de restricoes.</p></div>';
            }
        }
        
        // Carrega o script quando a p√°gina estiver pronta
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadGoogleMapsScript);
        } else {
            loadGoogleMapsScript();
        }
    </script>
    {% else %}
    <script>
        // API key n√£o configurada
        function initMap() {
            const mapContainer = document.getElementById('map');
            if (mapContainer) {
                mapContainer.innerHTML = '<div style="padding: 50px; text-align: center; color: #e74c3c; background: #ffe6e6; border-radius: 8px;"><h3>‚ö†Ô∏è API Key n√£o configurada</h3><p>Configure sua API key no arquivo <code>config.py</code></p><p style="font-size: 12px; margin-top: 10px;">Veja as instru√ß√µes em <code>COMO_OBTER_API_KEY_GOOGLE_MAPS.md</code></p></div>';
            }
        }
    </script>
    {% endif %}
</head>
<body>
    <h1>üå± C√°lculo de Emiss√µes GEE</h1>
    <p class="subtitle">Projeto de Engenharia Ambiental - USP S√£o Carlos</p>

    <div class="formulario">
        <form action="/calcular" method="post" id="formCalculo">
            <div class="form-group">
                <label>Tipo de Ve√≠culo:</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="tipo_carro" name="tipo_veiculo" value="carro" required checked>
                        <label for="tipo_carro">üöó Carro</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="tipo_caminhao" name="tipo_veiculo" value="caminhao" required>
                        <label for="tipo_caminhao">üöõ Caminh√£o</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Seu E-mail (para receber o relat√≥rio):</label>
                <input type="email" name="email" required placeholder="email@exemplo.com">
            </div>

            <div class="form-group">
                <label>Tipo de Combust√≠vel:</label>
                <select name="tipo_combustivel" required>
                    <option value="Diesel S10">Diesel S10</option>
                    <option value="Gasolina">Gasolina</option>
                    <option value="Etanol">Etanol</option>
                </select>
            </div>

            <div class="form-group">
                <label>Quantidade de Litros de Combust√≠vel:</label>
                <input type="number" name="litros" step="0.01" min="0" required placeholder="Ex: 500.5">
            </div>

            <div class="form-group">
                <label>Ano de Fabrica√ß√£o do Ve√≠culo:</label>
                <input type="number" name="ano_fabricacao" min="1980" max="2025" required placeholder="Ex: 2020">
                <span class="info-text">Necess√°rio para calcular o fator de ajuste por idade</span>
            </div>

            <div class="form-group">
                <label>üìç Localiza√ß√£o da Viagem (Opcional - Requer API Key do Google Maps):</label>
                <div class="address-group">
                    <div>
                        <label style="font-size: 13px; font-weight: 500;">Endere√ßo de Origem:</label>
                        <input type="text" id="endereco_origem" name="endereco_origem" placeholder="Digite endere√ßo, estabelecimento ou local">
                        <input type="hidden" id="lat_origem" name="lat_origem">
                        <input type="hidden" id="lng_origem" name="lng_origem">
                    </div>
                    <div>
                        <label style="font-size: 13px; font-weight: 500;">Endere√ßo de Destino:</label>
                        <input type="text" id="endereco_destino" name="endereco_destino" placeholder="Digite endere√ßo, estabelecimento ou local">
                        <input type="hidden" id="lat_destino" name="lat_destino">
                        <input type="hidden" id="lng_destino" name="lng_destino">
                    </div>
                </div>
                <button type="button" class="btn-calculate-distance" id="btn_calcular_distancia">üìè Calcular Dist√¢ncia Automaticamente</button>
                <div id="distance_result" class="distance-result" style="display: none;"></div>
                <span class="info-text">Voc√™ pode buscar por endere√ßos, estabelecimentos (ex: "McDonald's S√£o Carlos") ou locais. A dist√¢ncia ser√° calculada pela rota de estrada.</span>
            </div>

            <div class="map-container">
                <div id="map"></div>
            </div>

            <div class="form-group">
                <label>Quil√¥metros Rodados:</label>
                <input type="number" name="km_rodado" id="km_rodado" step="0.01" min="0" required placeholder="Ex: 2100">
                <span class="info-text">Necess√°rio para calcular intensidade de emiss√µes por km (pode ser preenchido automaticamente pela dist√¢ncia calculada)</span>
            </div>

            <div class="form-group" id="grupo_carga">
                <label>Carga Transportada (Toneladas):</label>
                <input type="number" name="carga_ton" id="carga_ton" step="0.01" min="0" placeholder="Ex: 25">
                <span class="info-text">Necess√°rio para calcular intensidade de emiss√µes por tonelada</span>
            </div>

            <button type="submit">üìä Calcular e Gerar Relat√≥rio Completo</button>
        </form>
    </div>

    <script>
        let map;
        let origemMarker = null;
        let destinoMarker = null;
        let origemAutocomplete;
        let destinoAutocomplete;
        let origemPlace;
        let destinoPlace;
        let isClickingOrigin = true; // Alterna entre origem e destino

        // Fun√ß√£o para mostrar/ocultar campo de carga baseado no tipo de ve√≠culo
        function toggleCampoCarga() {
            const tipoVeiculo = document.querySelector('input[name="tipo_veiculo"]:checked').value;
            const grupoCarga = document.getElementById('grupo_carga');
            const campoCarga = document.getElementById('carga_ton');
            
            if (tipoVeiculo === 'carro') {
                grupoCarga.classList.add('hidden');
                campoCarga.removeAttribute('required');
                campoCarga.value = '0'; // Define valor padr√£o para carro
            } else {
                grupoCarga.classList.remove('hidden');
                campoCarga.setAttribute('required', 'required');
                if (campoCarga.value === '0') {
                    campoCarga.value = ''; // Limpa o valor padr√£o quando mostrar
                }
            }
        }

        // Inicializa o mapa do Google
        function initMap() {
            // Marca que o mapa foi carregado
            window.GOOGLE_MAPS_LOADED = true;
            
            // Verifica se o Google Maps est√° carregado
            if (typeof google === 'undefined' || typeof google.maps === 'undefined') {
                console.error('Google Maps n√£o foi carregado');
                const mapContainer = document.getElementById('map');
                if (mapContainer) {
                    mapContainer.innerHTML = '<div style="padding: 50px; text-align: center; color: #e74c3c; background: #ffe6e6; border-radius: 8px;"><h3>Google Maps nao carregado</h3><p>Verifique sua API key e as APIs habilitadas no Google Cloud Console.</p><p style="font-size: 12px;">Abra o console do navegador (F12) para ver erros detalhados.</p></div>';
                }
                return;
            }
            
            try {
                // Centro inicial (S√£o Carlos, SP - Brasil)
                const saoCarlos = { lat: -22.0084, lng: -47.8908 };
            
                map = new google.maps.Map(document.getElementById('map'), {
                    center: saoCarlos,
                    zoom: 13,
                    mapTypeControl: true,
                    streetViewControl: true
                });

                // Autocomplete para endere√ßo de origem (aceita endere√ßos, estabelecimentos e locais)
                if (typeof google.maps.places !== 'undefined') {
                    origemAutocomplete = new google.maps.places.Autocomplete(
                        document.getElementById('endereco_origem'),
                        { 
                            types: ['geocode', 'establishment']
                        }
                    );
                    origemAutocomplete.bindTo('bounds', map);
                    origemAutocomplete.addListener('place_changed', function() {
                        origemPlace = origemAutocomplete.getPlace();
                        if (!origemPlace.geometry) {
                            return;
                        }
                        if (origemPlace.geometry.viewport) {
                            map.fitBounds(origemPlace.geometry.viewport);
                        } else {
                            map.setCenter(origemPlace.geometry.location);
                            map.setZoom(17);
                        }
                        
                        // Remove marcador anterior e adiciona novo
                        if (origemMarker) {
                            origemMarker.setMap(null);
                        }
                        origemMarker = new google.maps.Marker({
                            map: map,
                            position: origemPlace.geometry.location,
                            title: 'Origem',
                            icon: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png',
                            draggable: true
                        });
                        
                        // Salva coordenadas
                        document.getElementById('lat_origem').value = origemPlace.geometry.location.lat();
                        document.getElementById('lng_origem').value = origemPlace.geometry.location.lng();
                        
                        origemMarker.addListener('dragend', function() {
                            const pos = origemMarker.getPosition();
                            document.getElementById('lat_origem').value = pos.lat();
                            document.getElementById('lng_origem').value = pos.lng();
                            if (window.directionsRenderer) {
                                window.directionsRenderer.setMap(null);
                            }
                            calcularDistancia();
                        });
                        
                        isClickingOrigin = false;
                        calcularDistancia();
                    });
                }

                // Autocomplete para endere√ßo de destino (aceita endere√ßos, estabelecimentos e locais)
                if (typeof google.maps.places !== 'undefined') {
                    destinoAutocomplete = new google.maps.places.Autocomplete(
                        document.getElementById('endereco_destino'),
                        { 
                            types: ['geocode', 'establishment']
                        }
                    );
                    destinoAutocomplete.bindTo('bounds', map);
                    destinoAutocomplete.addListener('place_changed', function() {
                        destinoPlace = destinoAutocomplete.getPlace();
                        if (!destinoPlace.geometry) {
                            return;
                        }
                        if (destinoPlace.geometry.viewport) {
                            map.fitBounds(destinoPlace.geometry.viewport);
                        } else {
                            map.setCenter(destinoPlace.geometry.location);
                            map.setZoom(17);
                        }
                        
                        // Remove marcador anterior e adiciona novo
                        if (destinoMarker) {
                            destinoMarker.setMap(null);
                        }
                        destinoMarker = new google.maps.Marker({
                            map: map,
                            position: destinoPlace.geometry.location,
                            title: 'Destino',
                            icon: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png',
                            draggable: true
                        });
                        
                        // Salva coordenadas
                        document.getElementById('lat_destino').value = destinoPlace.geometry.location.lat();
                        document.getElementById('lng_destino').value = destinoPlace.geometry.location.lng();
                        
                        destinoMarker.addListener('dragend', function() {
                            const pos = destinoMarker.getPosition();
                            document.getElementById('lat_destino').value = pos.lat();
                            document.getElementById('lng_destino').value = pos.lng();
                            if (window.directionsRenderer) {
                                window.directionsRenderer.setMap(null);
                            }
                            calcularDistancia();
                        });
                        
                        isClickingOrigin = true;
                        calcularDistancia();
                    });
                }

                // Permite clicar no mapa para definir origem/destino
                map.addListener('click', function(event) {
                const lat = event.latLng.lat();
                const lng = event.latLng.lng();
                
                if (isClickingOrigin) {
                    // Define origem
                    if (origemMarker) {
                        origemMarker.setMap(null);
                    }
                    origemMarker = new google.maps.Marker({
                        map: map,
                        position: event.latLng,
                        title: 'Origem',
                        icon: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png',
                        draggable: true
                    });
                    document.getElementById('lat_origem').value = lat;
                    document.getElementById('lng_origem').value = lng;
                    
                    // Busca endere√ßo reverso
                    const geocoder = new google.maps.Geocoder();
                    geocoder.geocode({ location: event.latLng }, function(results, status) {
                        if (status === 'OK' && results[0]) {
                            document.getElementById('endereco_origem').value = results[0].formatted_address;
                        }
                    });
                    
                    origemMarker.addListener('dragend', function() {
                        const pos = origemMarker.getPosition();
                        document.getElementById('lat_origem').value = pos.lat();
                        document.getElementById('lng_origem').value = pos.lng();
                        calcularDistancia();
                    });
                    
                    isClickingOrigin = false;
                } else {
                    // Define destino
                    if (destinoMarker) {
                        destinoMarker.setMap(null);
                    }
                    destinoMarker = new google.maps.Marker({
                        map: map,
                        position: event.latLng,
                        title: 'Destino',
                        icon: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png',
                        draggable: true
                    });
                    document.getElementById('lat_destino').value = lat;
                    document.getElementById('lng_destino').value = lng;
                    
                    // Busca endere√ßo reverso
                    const geocoder = new google.maps.Geocoder();
                    geocoder.geocode({ location: event.latLng }, function(results, status) {
                        if (status === 'OK' && results[0]) {
                            document.getElementById('endereco_destino').value = results[0].formatted_address;
                        }
                    });
                    
                    destinoMarker.addListener('dragend', function() {
                        const pos = destinoMarker.getPosition();
                        document.getElementById('lat_destino').value = pos.lat();
                        document.getElementById('lng_destino').value = pos.lng();
                        calcularDistancia();
                    });
                    
                    isClickingOrigin = true;
                }
                
                calcularDistancia();
            });
                
            } catch (error) {
                console.error('Erro ao inicializar mapa:', error);
                const mapContainer = document.getElementById('map');
                if (mapContainer) {
                    mapContainer.innerHTML = '<div style="padding: 50px; text-align: center; color: #e74c3c;"><p>Erro ao inicializar o mapa: ' + error.message + '</p></div>';
                }
            }
        }

        // Fun√ß√£o para calcular dist√¢ncia de estrada entre origem e destino
        function calcularDistancia() {
            const latOrigem = parseFloat(document.getElementById('lat_origem').value);
            const lngOrigem = parseFloat(document.getElementById('lng_origem').value);
            const latDestino = parseFloat(document.getElementById('lat_destino').value);
            const lngDestino = parseFloat(document.getElementById('lng_destino').value);
            
            if (latOrigem && lngOrigem && latDestino && lngDestino) {
                const origem = new google.maps.LatLng(latOrigem, lngOrigem);
                const destino = new google.maps.LatLng(latDestino, lngDestino);
                
                // Remove rota anterior se existir
                if (window.directionsRenderer) {
                    window.directionsRenderer.setMap(null);
                }
                if (window.routeLine) {
                    window.routeLine.setMap(null);
                }
                
                // Usa Directions Service para calcular dist√¢ncia de estrada
                const directionsService = new google.maps.DirectionsService();
                const directionsRenderer = new google.maps.DirectionsRenderer({
                    map: map,
                    suppressMarkers: true, // N√£o mostra marcadores padr√£o (j√° temos os nossos)
                    preserveViewport: false, // Permite ajustar zoom
                    polylineOptions: {
                        strokeColor: '#3498db',
                        strokeWeight: 4,
                        strokeOpacity: 0.7
                    }
                });
                
                directionsService.route({
                    origin: origem,
                    destination: destino,
                    travelMode: google.maps.TravelMode.DRIVING, // Modo de condu√ß√£o (estrada)
                    unitSystem: google.maps.UnitSystem.METRIC // Sistema m√©trico (km)
                }, function(response, status) {
                    if (status === 'OK') {
                        // Desenha a rota no mapa
                        directionsRenderer.setDirections(response);
                        
                        // Calcula a dist√¢ncia total da rota
                        let distanciaTotal = 0;
                        const route = response.routes[0];
                        route.legs.forEach(function(leg) {
                            distanciaTotal += leg.distance.value; // Dist√¢ncia em metros
                        });
                        
                        const distanciaKm = (distanciaTotal / 1000).toFixed(2);
                        
                        // Atualiza campo de quil√¥metros
                        document.getElementById('km_rodado').value = distanciaKm;
                        
                        // Mostra resultado
                        const resultDiv = document.getElementById('distance_result');
                        resultDiv.style.display = 'block';
                        resultDiv.innerHTML = `üìç Dist√¢ncia calculada: ${distanciaKm} km (dist√¢ncia de estrada)`;
                        
                        // Ajusta zoom para mostrar toda a rota
                        const bounds = new google.maps.LatLngBounds();
                        route.legs.forEach(function(leg) {
                            bounds.extend(leg.start_location);
                            bounds.extend(leg.end_location);
                        });
                        map.fitBounds(bounds);
                        
                        // Salva o renderer para poder remov√™-lo depois
                        window.directionsRenderer = directionsRenderer;
                    } else {
                        // Se falhar, usa c√°lculo de linha reta como fallback
                        console.warn('Erro ao calcular rota:', status);
                        const distancia = google.maps.geometry.spherical.computeDistanceBetween(origem, destino);
                        const distanciaKm = (distancia / 1000).toFixed(2);
                        document.getElementById('km_rodado').value = distanciaKm;
                        
                        const resultDiv = document.getElementById('distance_result');
                        resultDiv.style.display = 'block';
                        resultDiv.innerHTML = `‚ö†Ô∏è Dist√¢ncia aproximada: ${distanciaKm} km (linha reta - n√£o foi poss√≠vel calcular rota)`;
                        
                        // Desenha linha reta como fallback
                        if (window.routeLine) {
                            window.routeLine.setMap(null);
                        }
                        window.routeLine = new google.maps.Polyline({
                            path: [origem, destino],
                            geodesic: true,
                            strokeColor: '#e74c3c',
                            strokeOpacity: 0.5,
                            strokeWeight: 2
                        });
                        window.routeLine.setMap(map);
                    }
                });
            }
        }

        // Adiciona event listeners aos radio buttons
        document.querySelectorAll('input[name="tipo_veiculo"]').forEach(radio => {
            radio.addEventListener('change', toggleCampoCarga);
        });

        // Bot√£o para calcular dist√¢ncia manualmente
        document.getElementById('btn_calcular_distancia').addEventListener('click', calcularDistancia);

        // Executa na carga da p√°gina para definir o estado inicial
        document.addEventListener('DOMContentLoaded', toggleCampoCarga);
        
        // Fun√ß√£o para lidar com erro de autentica√ß√£o do Google Maps
        window.gm_authFailure = function() {
            console.error('Google Maps Auth Failure - API key inv√°lida ou sem permiss√£o');
            window.GOOGLE_MAPS_LOADED = false;
            const mapContainer = document.getElementById('map');
            if (mapContainer) {
                mapContainer.innerHTML = '<div style="padding: 50px; text-align: center; color: #e74c3c; background: #ffe6e6; border-radius: 8px;"><h3>Erro de Autenticacao do Google Maps</h3><p><strong>PROBLEMA: Restricoes de Referenciador (HTTP Referrer)</strong></p><p style="margin-top: 15px; font-size: 14px;"><strong>SOLUCAO IMEDIATA:</strong></p><ol style="text-align: left; display: inline-block; max-width: 650px; font-size: 13px; line-height: 1.8;"><li>Acesse: <a href="https://console.cloud.google.com/apis/credentials" target="_blank" style="color: #3498db;">Google Cloud Console - Credenciais</a></li><li>Clique na sua API key (AIzaSyCaRYgdfZVFac-8...)</li><li>Em <strong>"Restricoes de aplicativo"</strong>:<ul style="margin-top: 5px;"><li>Escolha <strong>"Nenhuma"</strong> (temporariamente para testar)</li><li>OU escolha "Referenciadores de HTTP" e adicione:<ul><li><code>http://localhost:*</code></li><li><code>http://127.0.0.1:*</code></li></ul></li></ul></li><li>Clique em <strong>"SALVAR"</strong> e aguarde 30 segundos</li><li>Recarregue esta pagina: <strong>Ctrl+F5</strong></li></ol><p style="margin-top: 20px; font-size: 12px; color: #7f8c8d;">As APIs estao funcionando (teste confirmado). O problema e apenas as restricoes de acesso do navegador.</p></div>';
            }
        };
    </script>
</body>
</html>